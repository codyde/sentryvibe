{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":";;;AAiBA,IAAI,YAAA,GAAsC,IAAA;AAC1C,IAAI,aAAA,GAA+B,IAAA;AAiB5B,SAAS,cAAA,GAAyB;AACvC,EAAA,MAAM,GAAA,GAAM,QAAQ,GAAA,CAAI,YAAA;AACxB,EAAA,IAAI,CAAC,GAAA,EAAK;AAER,IAAA,IAAI,QAAQ,GAAA,CAAI,QAAA,KAAa,iBAAiB,OAAA,CAAQ,GAAA,CAAI,2BAA2B,MAAA,EAAQ;AAC3F,MAAA,OAAO,uBAAA;AAAA,IACT;AACA,IAAA,MAAM,IAAI,KAAA;AAAA,MACR;AAAA,KAEF;AAAA,EACF;AACA,EAAA,OAAO,GAAA;AACT;AAeO,SAAS,iBAAA,CAAkB,OAAA,GAAiC,EAAC,EAAmB;AACrF,EAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,OAAA,IAAW,cAAA,EAAe;AAGlD,EAAA,IAAI,YAAA,IAAgB,kBAAkB,OAAA,EAAS;AAC7C,IAAA,OAAO,YAAA;AAAA,EACT;AAGA,EAAA,YAAA,GAAe,oBAAA,CAAqB;AAAA,IAClC,OAAA;AAAA,IACA,OAAO,OAAA,CAAQ,KAAA;AAAA,IACf,YAAA,EAAc,QAAQ,YAAA,IAAgB;AAAA,GACvC,CAAA;AACD,EAAA,aAAA,GAAgB,OAAA;AAEhB,EAAA,OAAO,YAAA;AACT;AAQO,SAAS,oBAAA,CAAqB,OAAA,GAAiC,EAAC,EAAmB;AACxF,EAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,OAAA,IAAW,cAAA,EAAe;AAElD,EAAA,OAAO,oBAAA,CAAqB;AAAA,IAC1B,OAAA;AAAA,IACA,OAAO,OAAA,CAAQ,KAAA;AAAA,IACf,YAAA,EAAc,QAAQ,YAAA,IAAgB;AAAA,GACvC,CAAA;AACH;AAKA,eAAsB,mBAAA,CAAoB,OAAA,GAAiC,EAAC,EAIzE;AACD,EAAA,IAAI;AACF,IAAA,MAAM,MAAA,GAAS,kBAAkB,OAAO,CAAA;AAExC,IAAA,MAAM,MAAA,GAAS,MAAO,MAAA,CAAe,MAAA,CAAO,MAAA,EAAO;AAEnD,IAAA,IAAI,OAAO,IAAA,EAAM;AACf,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,OAAO,IAAA,CAAK,OAAA;AAAA,QACrB,OAAA,EAAS,OAAO,IAAA,CAAK;AAAA,OACvB;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,KAC9D;AAAA,EACF;AACF;AAKO,SAAS,gBAAA,GAAyB;AACvC,EAAA,YAAA,GAAe,IAAA;AACf,EAAA,aAAA,GAAgB,IAAA;AAClB","file":"index.js","sourcesContent":["/**\n * OpenCode Client Package\n * \n * Provides a shared OpenCode SDK client for use across the monorepo.\n * Both the frontend (Next.js) and runner can use this to communicate\n * with the OpenCode service.\n */\n\nimport { createOpencodeClient } from '@opencode-ai/sdk';\n\n// Re-export our custom types\nexport * from './types.js';\n\n// Define a type for the client to avoid SDK type issues\ntype OpenCodeClient = ReturnType<typeof createOpencodeClient>;\n\n// Client instance cache\nlet cachedClient: OpenCodeClient | null = null;\nlet cachedBaseUrl: string | null = null;\n\n/**\n * Configuration options for the OpenCode client\n */\nexport interface OpenCodeClientOptions {\n  /** Base URL of the OpenCode service. Defaults to OPENCODE_URL env var. */\n  baseUrl?: string;\n  /** Custom fetch implementation */\n  fetch?: typeof fetch;\n  /** Throw errors instead of returning them */\n  throwOnError?: boolean;\n}\n\n/**\n * Get the OpenCode service URL from environment\n */\nexport function getOpenCodeUrl(): string {\n  const url = process.env.OPENCODE_URL;\n  if (!url) {\n    // Default to localhost in development\n    if (process.env.NODE_ENV === 'development' || process.env.SHIPBUILDER_LOCAL_MODE === 'true') {\n      return 'http://localhost:4096';\n    }\n    throw new Error(\n      'OPENCODE_URL environment variable is required. ' +\n      'Set it to the URL of your OpenCode service (e.g., http://localhost:4096)'\n    );\n  }\n  return url;\n}\n\n/**\n * Create or get a cached OpenCode client\n * \n * The client is cached per base URL to avoid creating multiple instances.\n * \n * @example\n * ```typescript\n * import { getOpenCodeClient } from '@shipbuilder/opencode-client';\n * \n * const client = getOpenCodeClient();\n * const session = await client.session.create({ body: {} });\n * ```\n */\nexport function getOpenCodeClient(options: OpenCodeClientOptions = {}): OpenCodeClient {\n  const baseUrl = options.baseUrl || getOpenCodeUrl();\n  \n  // Return cached client if URL matches\n  if (cachedClient && cachedBaseUrl === baseUrl) {\n    return cachedClient;\n  }\n  \n  // Create new client\n  cachedClient = createOpencodeClient({\n    baseUrl,\n    fetch: options.fetch,\n    throwOnError: options.throwOnError ?? false,\n  });\n  cachedBaseUrl = baseUrl;\n  \n  return cachedClient;\n}\n\n/**\n * Create a fresh OpenCode client (not cached)\n * \n * Use this when you need a client with different options or\n * want to ensure a fresh connection.\n */\nexport function createOpenCodeClient(options: OpenCodeClientOptions = {}): OpenCodeClient {\n  const baseUrl = options.baseUrl || getOpenCodeUrl();\n  \n  return createOpencodeClient({\n    baseUrl,\n    fetch: options.fetch,\n    throwOnError: options.throwOnError ?? false,\n  });\n}\n\n/**\n * Check if the OpenCode service is healthy\n */\nexport async function checkOpenCodeHealth(options: OpenCodeClientOptions = {}): Promise<{\n  healthy: boolean;\n  version?: string;\n  error?: string;\n}> {\n  try {\n    const client = getOpenCodeClient(options);\n    // Use type assertion since SDK types may vary\n    const result = await (client as any).global.health();\n    \n    if (result.data) {\n      return {\n        healthy: result.data.healthy,\n        version: result.data.version,\n      };\n    }\n    \n    return {\n      healthy: false,\n      error: 'No response from health check',\n    };\n  } catch (error) {\n    return {\n      healthy: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Clear the cached client (useful for testing or reconnection)\n */\nexport function clearClientCache(): void {\n  cachedClient = null;\n  cachedBaseUrl = null;\n}\n"]}